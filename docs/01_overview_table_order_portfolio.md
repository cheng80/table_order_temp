# 테이블오더 및 대기열 통합 시스템 포트폴리오 – 1차 역기획 문서 (v3.0)

> 저장 위치(권장): `/docs/01_1st_reverse_planning.md`
> 
> 문서 성격: **프로젝트 기준 문서(1차 역기획)** — 이후 모든 세부 기획/구현 논의의 기준으로 사용

## 1. 문서 목적
본 문서는 **테이블오더 시스템과 매장 대기열 관리 시스템을 통합하여 포트폴리오로 재현**하기 위한 1차 역기획 문서이다.
실제 상용 환경의 모든 요소를 구현하는 것이 아니라, **카레 전문점(우마이 카레)**이라는 구체적인 업종 페르소나를 설정하여 복잡한 메뉴 옵션 처리, 대기 고객 호출, 원가 기반 순이익 분석, 날씨 데이터 연동 등 실무적인 비즈니스 로직을 설계하는 것을 목표로 한다.

본 문서는 이후 단계(세부 기획, ERD 확정, 구현 논의)의 기준 문서로 사용된다.

---

## 2. 프로젝트 핵심 주제
본 포트폴리오는 다음 다섯 가지 핵심 주제를 중심으로 구성된다.

1. **카레 전문점 특화 테이블오더 흐름 재현**  
   테이블에서 주문이 발생하고 주방(KDS)에서 처리되는 흐름을 재현하되, 맵기 조절(필수), 토핑 추가(선택) 등 복잡한 옵션 구조를 반영한다.

2. **매장 통합 대기열(웨이팅) 시스템 재현 (현황판 방식)**  
   입구 태블릿(W-01) 접수부터 매장 내 현황판(W-02) 호출까지 이어지는 대기열 라이프사이클을 구현한다.

3. **수익성 및 정산 로직 재현 (원가 관리)**  
   메뉴와 옵션별로 **원가(Cost)** 필드를 도입하여, 단순 매출액이 아닌 **실제 순이익**을 산출하는 정산 대시보드를 구현한다.

4. **외부 API 연동 및 날씨 기반 분석 재현 (방식 B)**  
   OpenWeatherMap API를 통해 일일 날씨(`weather_id`, `icon`)를 수집하고, 날씨와 판매량 간의 상관관계를 통계로 재현한다.

5. **토스페이먼츠 결제 연동 재현**  
   테이블 단말에서 결제가 이루어지고, 결제 결과가 주문 상태 및 매출 데이터에 반영되는 구조를 구현한다.

---

## 3. 용어 정의 및 제품 구성(운영 주체 기준)

- **점주(Owner)**: 사업자 단위의 운영 주체. 지점의 메뉴 원가 설정, 테이블 구성, 대기열 정책 및 날씨별 통계를 관리한다.
- **주방(KDS 사용자)**: 주문 조리 처리 및 실시간 대기 고객 호출/입장을 담당하는 현장 운영 주체.
- **손님(Guest)**: 
  - **대기 고객**: 매장 입구 태블릿(W-01)으로 접수하고 현황판(W-02)을 확인하는 사용자.
  - **주문 고객**: 테이블 태블릿(T-01)에서 카레 옵션을 선택하여 주문 및 결제 수행.
- **테이블오더 관리자(서비스 제공자)**: 플랫폼 운영 주체. 점주 데이터 온보딩 및 운영 정책 관리.

### 3-1. 점주 및 주방용 앱 (점주 앱)
**점주 앱에서 제공되는 화면(상위 4분류)**
1) **점주 회원가입 및 로그인**  
   - 사업자번호 기반 인증. **최초 로그인/접속 시 오늘 날씨 정보 수집 트리거(방식 B)** 작동.

2) **주방용 KDS 및 대기 관리 화면**  
   - 신규 주문 확인(맵기/토핑 옵션 포함) 및 조리 상태 처리.
   - 대기 명단 확인 및 호출/입장 처리(MQTT 전파).

3) **매장 테이블용 메뉴 화면**  
   - 카레 전문점 테마의 메뉴판. 점주 앱 내에서 미리보기/테스트 모드로 접근 가능.

4) **대기 등록 및 현황판 화면**  
   - 고객용 대기 등록(W-01) 및 매장 내부용 현황판(W-02) 화면 모드 제공.

---

## 4. 전체 시스템 구조 (개념 아키텍처)

### 구조 요약
- **서버(DB)가 모든 데이터의 기준(Source of Truth)**
- **실시간성은 MQTT를 통해 이벤트 전파 방식으로 처리**

개념 구조:
- 기기(테이블/대기/현황판) → 서버: 주문/결제/대기/날씨 수집 요청
- 서버 → DB: 모든 트랜잭션, 메뉴 원가, 일일 날씨(`id`, `icon`) 저장
- 서버 → MQTT: 주문 알림, **대기 호출**, 상태 변경 이벤트 전파
- 클라이언트: MQTT 수신 후 화면 실시간 갱신

### 설계 이유
- 데이터 저장과 실시간 전달을 분리함으로써 시스템 책임을 명확히 하기 위함
- **방식 B 날씨 연동**: 필요 시점(점주 접속)에만 호출하여 API 비용 절감 및 데이터 확실성 확보
- 원가 데이터를 스냅샷으로 저장하여 정확한 수익 분석 제공

---

## 5. 실무 환경 대비 포트폴리오 적용 범위

- **대기 알림**: 알림톡 API 대신 매장 내 **현황판(W-02) 모니터 노출 및 알림음(TTS)**으로 재현한다.
- **원가 관리**: 복잡한 식재료 재고 시스템 대신 메뉴/옵션별 '원가' 필드 입력을 통해 순이익을 산출한다.
- **날씨 데이터**: 시간별 날씨 대신 **일일 대표 날씨(ID, Icon)**를 주문 통계의 그룹화 기준으로 사용한다.

---

## 6. 핵심 워크플로우 (레벨 0)

### 6-1. 점포 및 메뉴 세팅 흐름
1. 점주 회원가입 / 로그인
2. 지점 생성 및 카레 메뉴/옵션 등록 (판매가와 **원가** 입력)
3. 대기열 예상 시간 계산을 위한 '평균 식사 시간' 설정 및 운영 시작

### 6-2. 대기 및 입장 흐름
1. 고객이 입구 태블릿(W-01)에서 대기 접수 → 예상 대기 시간 확인
2. 점주가 대기 현황 확인 후 [호출] 클릭 → **현황판(W-02)에 번호 표시**
3. 점주가 입장 처리 시 빈 테이블에 매칭

### 6-3. 주문 및 통계 흐름
1. 테이블에서 카레(맵기 필수) 주문 및 결제 → 서버가 **그날의 날씨 정보**와 함께 저장
2. 주방에서 조리 완료 처리
3. 점주가 매출 통계에서 "날씨/메뉴별 순이익 리포트" 확인

---

## 7. 계정 구조 기준 및 사업자번호 정책
*(기존 내용 유지: 점포당 1 계정 구조 및 법적 배경, 사업자번호 검증 정책)*

---

## 8. 데이터 모델 및 ERD 접근 방향

- 모든 운영 데이터는 지점(Store) 단위로 분리된다.
- **수익 분석**: 주문 상세 테이블에 판매가와 원가의 스냅샷을 저장한다.
- **날씨 통계**: 일일 날씨 테이블을 별도로 구성하고 주문 데이터와 날짜별로 매칭한다.
- **실시간 이벤트**: MQTT 메시지는 DB 모델을 복제하지 않고 식별값 위주로 전달한다.

---

## 9. 다음 단계 기획을 위한 체크포인트

- 카레 옵션(맵기 단계, 토핑 세트) 데이터셋 확정
- 대기 현황판(W-02) 애니메이션 및 알림음 로직 정의
- **방식 B** 날씨 수집 시 예외 처리(API 실패 시 Null 허용 등)
- 가상 정산 시 순이익(매출-원가) 집계 기준 확정

---

본 문서는 테이블오더 시스템의 큰 흐름과 카레 전문점 특화 기능을 공유하기 위한 기준 문서이며, 이후 모든 세부 기획은 본 문서를 기준으로 확장한다.
