# 시스템 기획서 (V04 · 재작성)

본 문서는 기존 V04 시스템 기획서를 기반으로 하되, **대기열(Waiting) 운영 기준과 일일 마감 정책을 명확히 반영한 최종 기획 문서**다.

본 문서는 이후 작성되는 모든 V04 문서(03~08)의 **최상위 기준 문서**로 사용된다.

---

## 1. 시스템 구성 개요

본 시스템은 매장 운영을 중심으로 다음 세 영역으로 구성된다.

1. 점주 및 직원용 운영 애플리케이션
2. 손님용 주문·대기 화면 (태블릿 / 전광판 모드)
3. 주방용 KDS 시스템

시스템의 핵심 목표는 **주문·결제 처리뿐 아니라 매장 유입(대기열)과 운영 판단을 함께 관리하는 것**이다.

---

## 2. 핵심 설계 원칙 (V04 확정)

### 2.1 명시적 조작 원칙

- 시스템은 손님을 자동으로 호출하지 않는다.
- 시스템은 입장을 자동으로 확정하지 않는다.
- 모든 상태 변화는 **점주 또는 직원의 명시적 조작**에 의해서만 발생한다.

### 2.2 참고 정보 분리 원칙

- 예상 대기시간, 통계 수치는 **운영 판단을 돕는 참고 정보**다.
- 이 값들은 로직 분기나 자동 처리 조건으로 사용되지 않는다.

### 2.3 데이터 누적 원칙

- 대기열 데이터는 운영 기록으로서 누적 저장한다.
- 전화번호는 원문 저장한다.
- 데이터 삭제·마스킹 정책은 추후 운영 기준에서 정의한다.

### 2.4 일일 운영 단위 원칙 (자정 기준, 배치 없음)

- 자정(00:00)은 **운영 마감 기준 시각**이다.
- 시스템에는 별도의 백그라운드 배치 작업이 존재하지 않는다.
- 전일에 생성된 미처리 대기 데이터는 **다음날 점주 앱 진입 시점에 선조회 후 정리**된다.
- 이 정리 작업은 자동 호출이나 자동 입장이 아닌, **운영 시작 전 데이터 정합을 맞추기 위한 마감 처리**다.

---

## 3. 대기열(Waiting) 시스템 정의

### 3.1 대기열의 성격

대기열은 주문이나 예약의 일부가 아닌, **매장 유입을 관리하기 위한 독립 운영 엔티티**다.

- 주문(order)과 직접 결합되지 않는다.
- 테이블(table)과 직접 연결되지 않는다.
- 예약(reservations)과 개념적으로 구분된다.

### 3.2 대기 등록 정책

- 손님은 매장의 만석 여부와 관계없이 언제든지 대기 등록이 가능하다.
- 만석이 아닌 경우 예상 대기시간은 0으로 표시된다.

### 3.3 전화번호 정책

- 대기 등록 시 전화번호 입력은 필수다.
- 활성 대기 상태(WAITING, CALLED) 기준으로 동일 전화번호 중복 등록은 허용되지 않는다.
- 중복 여부 판단은 애플리케이션 로직에서 처리한다.

---

## 4. 대기열 상태 모델 (개념)

- WAITING   : 대기 등록 완료
- CALLED    : 점주에 의해 호출됨
- ENTERED   : 입장 처리 완료
- NO_SHOW   : 호출 후 미입장
- CANCELED  : 대기 취소
- CLOSED    : 일일 마감 또는 운영 종료 처리

모든 상태 전이는 점주 또는 직원의 조작으로만 발생한다.

---

## 5. 화면 모드 개념 정의

### 5.1 W-01 : 대기열 관리 화면 (점주용)

- 대기 리스트 관리 및 호출
- 대기 모드 ON / OFF
- 일일 운영 기준으로 금일 대기만 관리

### 5.2 W-02 : 대기 현황판 / 셀프 등록 화면 (손님용)

- 현재 대기 현황 표시
- 예상 대기시간 표시(참고용)
- 이름 / 전화번호 입력을 통한 대기 등록

W-02는 비인증 화면이며, 관리 기능 접근은 불가하다.

---

## 6. 주문 및 예약 시스템과의 관계

- 주문은 테이블 기준으로 생성된다.
- 대기열은 주문의 선행 조건이 아니다.
- reservations는 추후 예약 기능 확장을 위한 영역이며, V04 기준에서는 대기열과 직접 연결되지 않는다.

---

본 문서는 **V04 시스템 설계의 기준 문서**이며, 이후 문서는 본 문서의 정의를 전제로 작성된다.